name: Test Dependency Security Review

on:
  pull_request:

permissions:
  contents: read
  pull-requests: write

jobs:
  dependency-review:
    name: "Test: ${{ matrix.name }}"
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: "Go – github.com/lib/pq upgrade"
            dependency: "github.com/lib/pq 1.10.0..1.10.9"
            ecosystem: go
          - name: "Go – golang.org/x/net upgrade"
            dependency: "golang.org/x/net 0.21.0..0.23.0"
            ecosystem: go
          - name: "Rust – serde upgrade"
            dependency: "serde 1.0.196..1.0.197"
            ecosystem: rust
          - name: "Rust – tokio upgrade"
            dependency: "tokio 1.36.0..1.37.0"
            ecosystem: rust
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run dependency review
        uses: ./
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          dependency: ${{ matrix.dependency }}
          ecosystem: ${{ matrix.ecosystem }}
          model: sonnet
          max_turns: 50
